<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- THEME_STYLE -->
  <link rel="stylesheet" href="prism-tomorrow.min.css">
  <title>MorphQL Live</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: var(--vscode-font-family);
      font-size: var(--vscode-font-size);
      color: var(--vscode-editor-foreground);
      background: var(--vscode-editor-background);
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* ── Toolbar ── */
    .toolbar {
      flex-shrink: 0;
      background: var(--vscode-sideBar-background, var(--vscode-editor-background));
      border-bottom: 1px solid var(--vscode-panel-border, #3c3c3c);
    }
    .toolbar-main {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 5px 12px;
    }
    .toolbar-source {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 3px 12px 5px;
      border-top: 1px solid var(--vscode-panel-border, #3c3c3c);
      opacity: 0.7;
    }
    .toolbar-source:hover { opacity: 1; }

    .filename {
      font-size: 11px;
      font-weight: 600;
      opacity: 0.8;
      font-family: var(--vscode-editor-font-family, monospace);
    }
    .status {
      font-size: 10px;
      font-weight: 700;
      padding: 2px 8px;
      border-radius: 10px;
      letter-spacing: 0.04em;
      flex-shrink: 0;
    }
    .status-ok   { background: rgba(74,222,128,0.15); color: #4ade80; }
    .status-err  { background: rgba(248,113,113,0.15); color: #f87171; }
    .status-idle { background: var(--vscode-badge-background, #3c3c3c); color: var(--vscode-badge-foreground, #ccc); }

    .source-arrow { font-size: 10px; opacity: 0.4; flex-shrink: 0; }
    .source-name {
      font-size: 11px;
      font-family: var(--vscode-editor-font-family, monospace);
      font-weight: 500;
      flex: 1;
      min-width: 0;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .source-name.none { font-style: italic; opacity: 0.45; }
    .source-btn {
      font-size: 10px;
      padding: 1px 6px;
      border: 1px solid var(--vscode-input-border, #555);
      border-radius: 3px;
      background: none;
      color: var(--vscode-editor-foreground);
      cursor: pointer;
      opacity: 0.55;
      flex-shrink: 0;
    }
    .source-btn:hover { opacity: 1; background: var(--vscode-list-hoverBackground, rgba(255,255,255,0.05)); }

    /* ── Tabs ── */
    .tabs {
      display: flex;
      background: var(--vscode-sideBar-background, var(--vscode-editor-background));
      border-bottom: 1px solid var(--vscode-panel-border, #3c3c3c);
      flex-shrink: 0;
    }
    .tab {
      padding: 6px 14px;
      font-size: 11px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      border-bottom: 2px solid transparent;
      color: var(--vscode-tab-inactiveForeground, #888);
      background: none;
      letter-spacing: 0.03em;
    }
    .tab:hover { color: var(--vscode-editor-foreground); }
    .tab.active {
      color: var(--vscode-tab-activeForeground, var(--vscode-editor-foreground));
      border-bottom-color: var(--vscode-textLink-foreground, #569cd6);
    }

    /* ── Content ── */
    .content { flex: 1; overflow: auto; position: relative; }
    .pane { display: none; min-height: 100%; }
    .pane.active { display: block; }

    pre {
      margin: 0;
      padding: 12px;
      font-family: var(--vscode-editor-font-family, 'Consolas', monospace);
      font-size: 12px;
      line-height: 1.6;
      white-space: pre-wrap;
      word-break: break-all;
    }

    /* Prism overrides */
    pre[class*="language-"],
    code[class*="language-"] {
      background: transparent !important;
      text-shadow: none !important;
      font-family: var(--vscode-editor-font-family, 'Consolas', monospace) !important;
      font-size: 12px !important;
    }

    .error-box {
      margin: 12px;
      padding: 10px 14px;
      background: rgba(248,113,113,0.07);
      border: 1px solid rgba(248,113,113,0.25);
      border-radius: 4px;
      color: var(--vscode-errorForeground, #f87171);
      font-family: var(--vscode-editor-font-family, monospace);
      font-size: 12px;
      line-height: 1.6;
    }
    .error-label {
      font-weight: 700;
      font-size: 10px;
      letter-spacing: 0.07em;
      text-transform: uppercase;
      margin-bottom: 5px;
      opacity: 0.7;
    }

    .empty-state {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 120px;
      opacity: 0.35;
      font-size: 12px;
      font-style: italic;
    }

    /* ── Structure tree ── */
    .tree { padding: 8px 12px; font-family: var(--vscode-editor-font-family, monospace); font-size: 12px; }
    .tree-label {
      font-size: 9px;
      font-weight: 800;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      opacity: 0.35;
      padding: 10px 0 4px;
    }
    .tree-divider { border-top: 1px solid var(--vscode-panel-border, #3c3c3c); margin: 10px 0; }

    details { padding-left: 14px; }
    summary {
      cursor: pointer;
      list-style: none;
      display: flex;
      align-items: center;
      gap: 5px;
      padding: 2px 0;
      user-select: none;
    }
    summary::-webkit-details-marker { display: none; }
    .chevron { font-size: 9px; opacity: 0.45; display: inline-block; transition: transform 0.1s; width: 10px; }
    details[open] > summary .chevron { transform: rotate(90deg); }
    .leaf-spacer { display: inline-block; width: 10px; }

    .fname { opacity: 0.85; }
    .ftype { font-size: 10px; font-weight: 700; letter-spacing: 0.04em; text-transform: uppercase; }
    .t-string  { color: #4ade80; }
    .t-number  { color: #fbbf24; }
    .t-boolean { color: #818cf8; }
    .t-array   { color: #f472b6; }
    .t-object  { color: #94a3b8; }
    .t-unknown { color: #64748b; }
    .open-badge { font-size: 9px; color: #818cf8; font-style: italic; margin-left: 3px; opacity: 0.8; }
  </style>
</head>
<body>

  <div class="toolbar">
    <div class="toolbar-main">
      <span class="filename" id="filename">No MorphQL file active</span>
      <span class="status status-idle" id="status">Idle</span>
    </div>
    <div class="toolbar-source">
      <span class="source-arrow">←</span>
      <span class="source-name none" id="source-name">no source file</span>
      <button class="source-btn" id="btn-open-source" title="Open source file in editor" style="display:none">open</button>
      <button class="source-btn" id="btn-change-source">change</button>
    </div>
  </div>

  <div class="tabs">
    <button class="tab active" data-pane="result">Result</button>
    <button class="tab" data-pane="code">Generated JS</button>
    <button class="tab" data-pane="structure">Structure</button>
  </div>

  <div class="content">
    <div class="pane active" id="pane-result">
      <div class="empty-state" id="result-empty">Open a .morphql file to see live output</div>
      <pre id="result-output" style="display:none"><code id="result-code" class="language-plaintext"></code></pre>
      <div class="error-box" id="result-error" style="display:none">
        <div class="error-label">Compilation / Execution Error</div>
        <div id="result-error-msg"></div>
      </div>
    </div>
    <div class="pane" id="pane-code">
      <div class="empty-state" id="code-empty">Successful compilation required.</div>
      <pre id="code-output" style="display:none"><code id="code-code" class="language-javascript"></code></pre>
    </div>
    <div class="pane" id="pane-structure">
      <div class="tree" id="structure-tree">
        <div class="empty-state" style="padding:20px 0">No structure detected</div>
      </div>
    </div>
  </div>

  <script src="panel.iife.js"></script>
</body>
</html>
